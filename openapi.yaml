openapi: 3.0.0
info:
  title: Graphify backend API
  description: API for my [frontend](https://github.com/worthant/graphify-angular-frontend)
  version: 2.0.0
servers:
  - url: https://delicate-corgi-brightly.ngrok-free.app/api
tags:
  - name: Auth
    description: Jwt Authentication endpoints
  - name: User
    description: User-related endpoints
  - name: Admin
    description: Admin-specific endpoints
  - name: Test
    description: Test endpoints
security:
  - bearerAuth: []
paths:
  /auth/signup:
    post:
      tags:
        - Auth
      summary: User signup
      description: Registers a new user and returns a JWT token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpDTO'
      responses:
        '200':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '409':
          description: User already exists
        '500':
          description: Internal server error

  /auth/login:
    post:
      tags:
        - Auth
      summary: User login
      description: Authenticates a user and returns a JWT token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignInDTO'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '401':
          description: Authentication failed
        '500':
          description: Internal server error

  /auth/logout:
    post:
      tags:
        - Auth
      summary: User logout
      description: Logs out the current user and saves it's session length.
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: User logged out successfully

  /auth/admin:
    post:
      tags:
        - Auth
      summary: Admin login
      description: Authenticates an admin user and returns a JWT token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignInDTO'
      responses:
        '200':
          description: Admin login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '401':
          description: Authentication failed
        '500':
          description: Internal server error

  /auth/restorePassword:
    post:
      tags:
        - Auth
      summary: Restore Password
      description: Sends a password reset link to the user's email.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmailDTO'
      responses:
        '200':
          description: Password reset link sent successfully.
        '400':
          description: User not found.
        '500':
          description: Internal server error.


  /user/points:
    post:
      tags:
        - User
      summary: Retrieve User Points
      description: Retrieves all points associated with the currently authenticated user.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Points retrieved successfully.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PointDTO'
        '404':
          description: User not found.
        '500':
          description: Internal server error.

  /user/addPoint:
    post:
      tags:
        - User
      summary: Add a New Point
      description: Adds a new point for the currently authenticated user.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                x:
                  type: number
                  format: double
                  description: The X coordinate of the point.
                y:
                  type: number
                  format: double
                  description: The Y coordinate of the point.
                r:
                  type: number
                  format: double
                  description: The radius in which the point resides.
      responses:
        '200':
          description: Point added successfully.
        '500':
          description: Internal server error.

  /user/redrawAllPoints:
    post:
      tags:
        - User
      summary: Redraw All Points
      description: Redraws all points for the currently authenticated user with a new radius.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                r:
                  type: number
                  format: double
                  description: The new radius for all points.
      responses:
        '200':
          description: Points redrawn successfully.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PointDTO'
        '500':
          description: Internal server error.

  /user/deleteAllPoints:
    delete:
      tags:
        - User
      summary: Delete All Points
      description: Deletes all points associated with the currently authenticated user.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: All points deleted successfully.
        '404':
          description: User not found.
        '500':
          description: Internal server error.

  /user/deletePoint:
    delete:
      tags:
        - User
      summary: Delete a Single Point
      description: Deletes a specific point for the currently authenticated user.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PointDTO'
      responses:
        '200':
          description: Point deleted successfully.
        '404':
          description: User or point not found.
        '500':
          description: Internal server error.

  /user/changePassword:
    post:
      tags:
        - User
      summary: Change User Password
      description: Allows the currently authenticated user to change their password.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordDTO'
      responses:
        '200':
          description: Password changed successfully.
        '400':
          description: Bad request (Invalid data).
        '500':
          description: Internal server error.


  /admin/users:
    get:
      tags:
        - Admin
      summary: Get all users
      description: Retrieves a list of all users (admin access only).
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserDTO'
        '500':
          description: Internal server error

  /admin/promote/{userId}:
    post:
      tags:
        - Admin
      summary: Promote User to Admin
      description: Promotes a specified user to an admin role.
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: ID of the user to promote
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: User promoted to admin successfully.
        '404':
          description: User not found
        '500':
          description: Internal server error

  /admin/points/{userId}:
    get:
      tags:
        - Admin
      summary: Get Points of a User
      description: Retrieves all points associated with a specified user (admin access only).
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: ID of the user whose points are to be retrieved
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Points retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PointDTO'
        '404':
          description: User not found
        '500':
          description: Internal server error

  /admin/removeUser/{userId}:
    post:
      tags:
        - Admin
      summary: Remove a User
      description: Removes a user specified by the user ID.
      security:
        - bearerAuth: [ ]
      parameters:
        - name: userId
          in: path
          required: true
          description: ID of the user to be removed
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: User removed successfully.
        '404':
          description: User not found.
        '500':
          description: Internal server error.

  /admin/getUserSessions/{userId}:
    post:
      tags:
        - Admin
      summary: Get User Sessions
      description: Retrieves the session information for a specified user.
      security:
        - bearerAuth: [ ]
      parameters:
        - name: userId
          in: path
          required: true
          description: ID of the user whose sessions are to be retrieved
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: User sessions retrieved successfully.
        '404':
          description: User not found.
        '500':
          description: Internal server error.

  /admin/getLastUserSessionDuration/{userId}:
    post:
      tags:
        - Admin
      summary: Get Last User Session Duration
      description: Retrieves the duration of the last session for a specified user.
      security:
        - bearerAuth: [ ]
      parameters:
        - name: userId
          in: path
          required: true
          description: ID of the user whose last session duration is to be retrieved
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Last session duration retrieved successfully.
        '404':
          description: User not found.
        '500':
          description: Internal server error.

  /admin/getNumberOfUserPoints/{userId}:
    post:
      tags:
        - Admin
      summary: Get Number of User Points
      description: Retrieves the number of points associated with a specified user.
      security:
        - bearerAuth: [ ]
      parameters:
        - name: userId
          in: path
          required: true
          description: ID of the user whose points count is to be retrieved
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Number of points retrieved successfully.
        '404':
          description: User not found.
        '500':
          description: Internal server error.

  /example:
    get:
      tags:
        - Test
      summary: Example endpoint
      description: Returns "Hello World!"
      responses:
        '200':
          description: A simple text message
          content:
            text/plain:
              schema:
                type: string
                example: HelloWorld!

components:
  schemas:
    SignUpDTO:
      type: object
      properties:
        username:
          type: string
          description: The unique username of the user.
          example: yourUsername
          minLength: 3
          maxLength: 20
          pattern: '^[a-zA-Z0-9_]+$'
        email:
          type: string
          description: Unique email of the user.
          example: your_email@gmail.com
        password:
          type: string
          description: The password of the user.
          example: securePassword123
          format: password
          minLength: 8
    SignInDTO:
      type: object
      properties:
        email:
          type: string
          description: Unique email of the user.
          example: your_email@gmail.com
        password:
          type: string
          description: The password of the user.
          example: securePassword123
          format: password
          minLength: 8
    PointDTO:
      type: object
      properties:
        x:
          type: number
          format: double
          description: The X coordinate of the point.
        y:
          type: number
          format: double
          description: The Y coordinate of the point.
        r:
          type: number
          format: double
          description: The radius in which the point resides.
        result:
          type: boolean
          description: Indicates whether the point is within the defined area.
    UserDTO:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
    PasswordDTO:
      type: object
      properties:
        oldPassword:
          type: string
          format: password
        newPassword:
          type: string
          format: password
    EmailDTO:
      type: object
      properties:
        email:
          type: string
          format: email
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
